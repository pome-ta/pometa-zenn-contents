---
title: "ã€module ç·¨ã€‘#2: a-Shell(mini) ã§ã‚¢ãƒ—ãƒªã‚’ã¤ãã‚‹ã€Rubicon-ObjCã€‘"
emoji: "ğŸ§³"
type: "tech"
topics: ["Python", "iOS", "objectivec", "ashell", "rubiconobjc"]
published: false
---

# ã¯ã˜ã‚ã«

iPhone, iPad ã®ç„¡æ–™ã‚¢ãƒ—ãƒª[a-Shell](https://holzschu.github.io/a-Shell_iOS/) ã‚’ä½¿ã£ã¦ã€[UIKit](https://developer.apple.com/jp/documentation/uikit/) ã‚’å‘¼ã³å‡ºã—ã€ã‚¢ãƒ—ãƒªã‚’ã¤ãã‚Šã¾ã™ã€‚
:::message
App Store ã¸å…¬é–‹ã¯ã§ãã¾ã›ã‚“
:::

ä»Šå›ã® View ã®è¡¨ç¤ºçµæœã¯ã€å‰å›ã¨å¤‰ã‚ã‚Šã‚ã‚Šã¾ã›ã‚“ã€‚1 ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ[`singleFileSample.py`](https://github.com/pome-ta/a-Shell_Rubicon-ObjC_UIKitSamples/blob/main/singleFileSample.py)ï¼‰ã ã£ãŸã‚³ãƒ¼ãƒ‰ã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã—ã€ç…©é›‘ã•ã®å›é¿ã€å–ã‚Šå›ã—ã‚’ã‚ˆãã™ã‚‹ã®ãŒç›®çš„ã§ã™ã€‚
ä»Šå¾Œè¨ªã‚Œã‚‹ã‚¢ãƒ—ãƒªé–‹ç™ºã«ãŠã„ã¦ã‚‚ã€å®Ÿè£…ã—ãŸã„ã‚³ãƒ¼ãƒ‰ã«é›†ä¸­ã§ãã‚‹åˆ©ç‚¹ã‚‚ã‚ã‚Šã¾ã™ã€‚

![image](https://github.com/user-attachments/assets/d03ba5d8-9fe3-4f15-8126-250d70b92f62)

åˆ†å‰²ä½œæ¥­ã¨åŒæ™‚ã«ã‚³ãƒ¼ãƒ‰ã®èª¬æ˜ã‚’ã—ã¾ã™ã€‚ä¸æ˜ç­ãªéƒ¨åˆ†ã®è§£æ±ºã«ç¹‹ãŒã‚Œã°å¹¸ã„ã§ã™ã€‚

## å…¨ 3 éƒ¨æ§‹æˆã®ç¬¬ 2 éƒ¨ã§ã™

ã“ã®è¨˜äº‹ã‚’å«ã‚ã€3 éƒ¨æ§‹æˆã§è§£èª¬ã‚’ã—ã¦ã„ãã¾ã™:

- ã€åŸºæœ¬ç·¨ã€‘#1: a-Shell(mini) ã§ã‚¢ãƒ—ãƒªã‚’ã¤ãã‚‹ã€Rubicon-ObjCã€‘

  - a-Shell å®Ÿè¡Œã®å¤§ã¾ã‹ãªæµã‚Œ
  - 1 ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã®ç°¡æ˜“ãªå®Ÿè£…

- ã€module ç·¨ã€‘#2: a-Shell(mini) ã§ã‚¢ãƒ—ãƒªã‚’ã¤ãã‚‹ã€Rubicon-ObjCã€‘

  - ï¼ˆä»Šå›ã¯ã“ã“ï¼‰
  - 1 ãƒ•ã‚¡ã‚¤ãƒ«ã ã£ãŸã‚³ãƒ¼ãƒ‰ã‚’ module ã¸åˆ†å‰²
  - å„éƒ¨ã‚³ãƒ¼ãƒ‰ã®èª¬æ˜
  - ã‚¢ãƒ—ãƒªåˆ¶ä½œã®ãŸã‚ã®ç’°å¢ƒæ•´å‚™

- ã€åˆ¶ä½œç·¨ã€‘#3: a-Shell(mini) ã® Python ã§ UIKit ã‹ã‚‰ View ã‚’å‘¼ã³å‡ºã™ã€Rubicon-ObjCã€‘
  - Rubicon-ObjC ã‚’ä½¿ã£ãŸå®Ÿè£…ã®æµã‚Œ
  - Swift, Objective-C ã®ã‚³ãƒ¼ãƒˆãƒ‰ã‚’ Rubicon-ObjC ã¸è½ã¨ã—è¾¼ã¿

3 ã¤ã®è¨˜äº‹ã‚’é€šã—ãŸã‚³ãƒ¼ãƒ‰ã¯ã€GitHub ã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚

@[card](https://github.com/pome-ta/a-Shell_Rubicon-ObjC_UIKitSamples)

:::message

### å„ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±

```
iOS           : 18.3.1
a-Shell(mini) :  1.15.11
  Python      :  3.11.0
Rubicon-ObjC  :  0.5.0
```

(ä¸€å¿œ)a-Shell ä»¥å¤–ã« [Pythonista for iOS](https://omz-software.com/pythonista/index.html) ã§ã€æŒ™å‹•ç¢ºèªã‚’ã—ã¦ã„ã¾ã™ã€‚
:::

:::message alert

### module å†…ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†å¾Œã®å®Ÿè¡Œã«ã¤ã„ã¦

import ã™ã‚‹ module ã‚’ç·¨é›†ã—å®Ÿè¡Œã—ãŸå ´åˆã€**å¤‰æ›´å†…å®¹ãŒåæ˜ ã•ã‚Œã¾ã›ã‚“** (ã¾ãŸã¯ã€å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™)ã€‚
ãã®ãŸã‚ã€module å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ãŸå¾Œã¯ã€**a-Shell ã‚’å†èµ·å‹•**ã—ã¦ã‹ã‚‰ã€å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚
:::

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

[GitHub ã®ãƒªãƒã‚¸ãƒˆãƒª](https://github.com/pome-ta/a-Shell_Rubicon-ObjC_UIKitSamples) ã¯ã€ä»¥ä¸‹ã®æ§‹æˆã§ã™ã€‚

```shell:
[~a-Shell_Rubicon-ObjC_UIKitSamples]$ tree
.
â”œâ”€â”€ README.md
â”œâ”€â”€ (exampleSFSymbolsViewer.py: æ¬¡å›)
â”œâ”€â”€ pyrubicon
â”‚   â””â”€â”€ objc
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ api.py
â”‚       â”œâ”€â”€ collections.py
â”‚       â”œâ”€â”€ ctypes_patch.py
â”‚       â”œâ”€â”€ eventloop.py
â”‚       â”œâ”€â”€ runtime.py
â”‚       â””â”€â”€ types.py
â”œâ”€â”€ rbedge
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ app.py
â”‚   â”œâ”€â”€ enumerations.py
â”‚   â”œâ”€â”€ functions.py
â”‚   â”œâ”€â”€ lifeCycle.py
â”‚   â”œâ”€â”€ objcMainThread.py
â”‚   â”œâ”€â”€ pdbr.py
â”‚   â””â”€â”€ rootNavigationController.py
â”œâ”€â”€ (singleFileSample.py: å‰å›)
â””â”€â”€ withModuleToSample.py
```

`rbedge` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ©Ÿèƒ½ã‚’æŒã¡ã¾ã™ã€‚`singleFileSample.py` ã‚’åˆ†å‰²ã—ãŸã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

`pyrubicon` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ã€[ã€éæ¨å¥¨ã€‘Rubicon-ObjC ã®æ‰‹å‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ»ã‚¤ãƒ³ãƒ›ã‚šãƒ¼ãƒˆ](https://zenn.dev/pometa/articles/466cd4b39f9684)ã€ã®æ–¹æ³•ã§æ ¼ç´ã—ã¦ã„ã¾ã™ã€‚

@[card](https://zenn.dev/pometa/articles/466cd4b39f9684)

# `rbedge` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

_ã€Œ**r**u**b**icon å·ã®æ©‹ï¼ˆbridgeï¼‰ã®ç«¯ï¼ˆedgeï¼‰ã€_
ã¨ã—ã¦ã€`rbedge` ã¨å‘½åã—ã¦ã¿ã¾ã—ãŸã€‚åˆ¥ã® ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã§ã‚‚å•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

## `__init__.py`

```python
__version__ = '0.0.0'

import sys
import os
import ctypes

from pyrubicon.objc.api import ObjCClass, ObjCInstance
from pyrubicon.objc.runtime import Foundation

ObjCClass.auto_rename = True

#######################################################
# --- exception
#######################################################
# todo: from objc_util.py of Pythonista3
ExceptionHandlerFuncType = ctypes.CFUNCTYPE(None, ctypes.c_void_p)


def NSSetUncaughtExceptionHandler(_exc: ExceptionHandlerFuncType) -> None:
  _NSSetUncaughtExceptionHandler = Foundation.NSSetUncaughtExceptionHandler
  _NSSetUncaughtExceptionHandler.restype = None
  _NSSetUncaughtExceptionHandler.argtypes = [
    ExceptionHandlerFuncType,
  ]
  _NSSetUncaughtExceptionHandler(_exc)


def _objc_exception_handler(_exc):
  exc = ObjCInstance(_exc)
  with open(os.path.expanduser('~/Documents/_rubicon_objc_exception.txt'),
            'w') as f:
    import datetime
    f.write(
      'The app was terminated due to an Objective-C exception. Details below:\n\n%s\n%s\n'
      % (datetime.datetime.now(), exc))


_handler = ExceptionHandlerFuncType(_objc_exception_handler)
NSSetUncaughtExceptionHandler(_handler)
#######################################################
```

`__init__.py` ã¯ã€ç©ºã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚ã‚‹äº‹ãŒå¤šã„ã§ã™ãŒã€ã‚³ãƒ¼ãƒ‰ä½“ã«å½±éŸ¿ã•ã›ãŸã„ã‚‚ã®ã¨ã—ã¦ã€ä»¥ä¸‹ 2 ç‚¹è¨­å®šã—ã¦ã„ã¾ã™ã€‚

### `ObjCClass.auto_rename` ã®`True`

é€£ç¶šã§å®Ÿè¡Œã™ã‚‹éš›ã® class name è¡çªã‚¨ãƒ©ãƒ¼ã‚’å›é¿ã—ã¾ã™ã€‚

@[card](https://rubicon-objc.readthedocs.io/en/stable/tutorial/tutorial-2.html#class-naming)
@[card](https://zenn.dev/qqfunc/articles/b39a657990c9f0#:~:text=Objective%2DC%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E5%AE%9A%E7%BE%A9)

### é–¢æ•°: `NSSetUncaughtExceptionHandler`

```py
_handler = ExceptionHandlerFuncType(_objc_exception_handler)
NSSetUncaughtExceptionHandler(_handler)
```

Objective-C ã§ã®ã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’ a-Shell ã®`./Documents` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸`_rubicon_objc_exception.txt` ã¨ã—ã¦åãå‡ºã—ã¾ã™ã€‚

```py
with open(os.path.expanduser('~/Documents/_rubicon_objc_exception.txt'), 'w') as f:
```

Main Thread å¤–ã§ã® UI æ›´æ–°ã‚„ã€é…åˆ—ã® index å¤–ã®å‘¼ã³å‡ºã—ãªã©ã‚’æ•™ãˆã¦ãã‚Œã¾ã™ã€‚
æ•æ‰ã—ã¦ãã‚Œã‚‹ã‚¨ãƒ©ãƒ¼ã¯å°‘ãªã„ã§ã™ãŒã€ãƒ‡ãƒãƒƒã‚°ã™ã‚‹æ‰‹ç«‹ã¦ãŒå°‘ãªã„ Rubicon-ObjC ã§ã¯å°ã•ãªæƒ…å ±ã§ã‚‚ã‚ã‚ŠãŒãŸã„ã§ã™ã€‚

:::message
Pythonista3 ã®`objc_util.py` å†…ã®ã‚³ãƒ¼ãƒ‰ã‚’å‚è€ƒã«ã—ã¦ã„ã¾ã™ã€‚
:::

Apple Developer Documents ã®ãƒªãƒ³ã‚¯ã¯ä»¥ä¸‹ã¨ãªã‚Šã¾ã™:
@[card](https://developer.apple.com/documentation/foundation/1409609-nssetuncaughtexceptionhandler?language=objc)

## `enumerations.py`

```python
# ä¸€éƒ¨ã‚’æŠœãå‡ºã—
from dataclasses import dataclass


class UIModalPresentationStyle:
  automatic: int = -2
  none: int = -1
  fullScreen: int = 0
  pageSheet: int = 1
  formSheet: int = 2
  currentContext: int = 3
  custom: int = 4
  overFullScreen: int = 5
  overCurrentContext: int = 6
  popover: int = 7
  blurOverFullScreen: int = 8

@dataclass
class UIRectEdge:
  none: int = 0
  top: int = 1 << 0
  left: int = 1 << 1
  bottom: int = 1 << 2
  right: int = 1 << 3
  all: int = top | left | bottom | right
```

Enumeration Case ã‚’ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚class ã§è¦ç´ ã‚’ã¾ã¨ã‚`.` (ãƒ‰ãƒƒãƒˆã§)å‘¼ã³å‡ºã—ã‚’ã—ãŸã„ã®ã§ã€Swift ã®è¡¨è¨˜ã§çµ±ä¸€ã—ã¦ã„ã¾ã™ã€‚
æ¼”ç®—ãŒå¿…è¦ï¼ˆã«ã€ãªã‚Šãã†ï¼‰ãªè¦ç´ ã¯ã€`@dataclass` ã§å®šç¾©ã—ã¦ã„ã¾ã™ã€‚
ã—ã‹ã—ã€Apple Developer Documentation ã¯ Enumeration Case ã®ï¼ˆSwift ã‚‚ Objective-C ã®ãƒšãƒ¼ã‚¸ã‚‚ï¼‰å€¤ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚

@[card](https://developer.apple.com/documentation/uikit/uimodalpresentationstyle)

ãã®å ´åˆã¯ã€Rust ã® Apple frameworks ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã® [`objc2`](https://github.com/madsmtm/objc2) ã‹ã‚‰ source ã‚’ç¢ºèªã—ã«è¡Œã£ã¦ã„ã¾ã™ã€‚
@[card](https://docs.rs/objc2-ui-kit/latest/src/objc2_ui_kit/generated/UIViewController.rs.html#40)

æƒ…å ±ãŒå¤ã„å¯èƒ½æ€§ã¯ã‚ã‚Šã¾ã™ãŒã€Xamarin ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã‚‚ç¨€ã«è¦‹ã¤ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
@[card](https://learn.microsoft.com/ja-jp/previous-versions/xamarin/ios/)

## `functions.py`

```python
import ctypes

from pyrubicon.objc.api import ObjCInstance
from pyrubicon.objc.runtime import Foundation, Class


def NSStringFromClass(cls: Class) -> ObjCInstance:
  _NSStringFromClass = Foundation.NSStringFromClass
  _NSStringFromClass.restype = ctypes.c_void_p
  _NSStringFromClass.argtypes = [Class]
  return ObjCInstance(_NSStringFromClass(cls))
```

`Function` ã‚’ã¾ã¨ã‚ã¦ã„ã‚‹å ´æ‰€ã§ã™ã€‚ç¾åœ¨ã¯[`NSStringFromClass`](https://developer.apple.com/documentation/foundation/1395143-nsstringfromclass?language=objc) 1 ã¤ã®ã¿ã§ã™ã€‚

`NSStringFromClass` ã¯å¼•æ•°ã«ã—ãŸ Class åã‚’æ–‡å­—åˆ—ã§è¿”ã—ã¾ã™ã€‚å¿…é ˆã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ä»Šå›ã¯ View ã® Life Cycle ç¢ºèªã®ãŸã‚`print` ã™ã‚‹ç›®çš„ã§ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
@[card](https://developer.apple.com/documentation/foundation/1395143-nsstringfromclass?language=objc)

## `lifeCycle.py`

```python
import asyncio
#import logging

from pyrubicon.objc.eventloop import EventLoopPolicy

__all__ = [
  'loop',
]
#logging.basicConfig(level=logging.DEBUG)
asyncio.set_event_loop_policy(EventLoopPolicy())
#loop = asyncio.get_event_loop()
loop = asyncio.new_event_loop()
#loop.set_debug(True)
```

éåŒæœŸã® event loop ãŒèµ°ã‚‹ã“ã¨ã§ã€a-Shell ã§ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã›ãšã« View ã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚
ãªãŠã€Pythonista3, Pyto ã¯å¤‰æ•°`loop` ãŒç„¡ãã¦ã‚‚ View ã¯è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

ç§ãŒ`asyncio` ã«ã‚ã‹å‹¢ãªã®ã§ã€`logging` module ã§çŠ¶æ…‹ã‚’ç¢ºèªã—ã‚ˆã†ã—ã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚Šã¾ã™ã­ã€‚
@[card](https://rubicon-objc.readthedocs.io/en/stable/how-to/async.html)

### `iOSLifecycle()` ã§ã¯ãªã„

å¤‰æ•°`loop` ã¯ã€ã“ã®å¾Œã«èª¬æ˜ã™ã‚‹[class `App`](#app.py) ã®ä¸­ã§ãƒ«ãƒ¼ãƒ—ã‚’èµ°ã‚‰ã›ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

```python:app.py
class App:
  # ä¸­ç•¥
  def main_loop(self) -> None:
    loop.run_forever()  # <- ã“ã“
    loop.close()
```

Rubicon-ObjC ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚ˆã‚‹ã¨ã€iOS ã«ã¯`loop.run_forever(lifecycle=iOSLifecycle())` ã¨ã€ã‚ã‚Šã¾ã™ãŒ`iOSLifecycle` ã¯ä½¿ã„ã¾ã›ã‚“ã€‚
@[card](https://rubicon-objc.readthedocs.io/en/stable/how-to/async.html#integrating-asyncio-with-ios-and-uiapplication)

a-Shell ä¸Šã§å‹•ã‹ã—ã¦ã„ã‚‹ã®ã§ã€Rubicon-ObjC ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ç¤ºã—ã¦ã„ã‚‹ iOS ã¨ã¯é•ã„ã¾ã™ã€‚
Rubicon-ObjC ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã® iOS ã¯ã€Œãã®ã‚¢ãƒ—ãƒªå˜ä½“ï¼ˆã¤ã¾ã‚Šã€é€šå¸¸ã®ã‚¢ãƒ—ãƒªæŒ™å‹•ï¼‰ã€ã§ã€èµ·å‹•ãƒ»çµ‚äº†ã‚’ç®¡ç†ã—ã¾ã™ãŒã€èµ·å‹•ãƒ»çµ‚äº†ã¯ a-Shell å´ãŒæŒã£ã¦ã„ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

### `new` ã‹`get` ã‹

`new_event_loop` , `get_event_loop` ã©ã¡ã‚‰ã‚’é¸ã‚“ã§ã‚‚ã€ã‚¨ãƒ©ãƒ¼ãªãå®Ÿè¡Œã§ãã¾ã™ã€‚
ä»Šã®ã¨ã“ã‚`get_event_loop` ã¯ã€`logging` ã§`Warning` ãŒå‡ºã‚‹ã®ã§`new_event_loop` ã¨ã—ã¦ã„ã¾ã™ã€‚ã©ã£ã¡ãŒæ­£è§£ã‹ã¯ã¾ã æ•´ç†ã§ãã¦ã„ã¾ã›ã‚“ã€‚

```python
#loop = asyncio.get_event_loop()
loop = asyncio.new_event_loop()
```

- `get_event_loop`
  @[card](https://docs.python.org/ja/3.13/library/asyncio-eventloop.html#asyncio.get_event_loop)

- `new_event_loop`
  @[card](https://docs.python.org/ja/3.13/library/asyncio-eventloop.html#asyncio.new_event_loop)

## `objcMainThread.py`

```python
from ctypes import byref, cast, Structure
import functools

from pyrubicon.objc.api import Block, ObjCClass, ObjCInstance
from pyrubicon.objc.runtime import libobjc, objc_block, objc_id

NSThread = ObjCClass('NSThread')


class struct_dispatch_queue_s(Structure):
  pass  # No _fields_, because this is an opaque structure.


_dispatch_main_q = struct_dispatch_queue_s.in_dll(libobjc, '_dispatch_main_q')


def dispatch_get_main_queue():
  return ObjCInstance(cast(byref(_dispatch_main_q), objc_id))


libobjc.dispatch_async.restype = None
libobjc.dispatch_async.argtypes = [
  objc_id,
  objc_block,
]


def onMainThread(func):

  @functools.wraps(func)
  def wrapper(*args, **kwargs):
    if NSThread.isMainThread:
      func(*args, **kwargs)
    block = Block(functools.partial(func, *args, **kwargs), None)
    libobjc.dispatch_async(dispatch_get_main_queue(), block)

  return wrapper
```

Main Thread ã§å‡¦ç†ã•ã›ãŸã„æ‰€ã«ã€é–¢æ•°`onMainThread` ã‚’ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿`@onMainThread` ã¨ã—ã¦æŒ‡å®šã—ã¾ã™ã€‚

[class `App`](#app.py) ã®`present` ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ã€`rootViewController` ã®`presentViewController_animated_completion_`ã€‚
ãã—ã¦ã€`UINavigationController` ã®`initWithRootViewController_` ã‚’ Main Thread å‡¦ç†ã™ã‚‹å ´é¢ã§ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

```python
class App:
  # ä¸­ç•¥
  def present(self) -> None:

    @onMainThread
    def present_viewController(viewController: UIViewController,
                               style: int) -> None:

      presentViewController = RootNavigationController.alloc(
      ).initWithRootViewController_(viewController)

      presentViewController.setModalPresentationStyle_(style)

      self.rootViewController.presentViewController_animated_completion_(
        presentViewController, True, None)

    present_viewController(self.viewController, self.modalPresentationStyle)
```

Main Thread å‡¦ç†ã®æ–¹æ³•ã¨ã—ã¦ã€ä»–ã«ã‚‚æ§˜ã€…ãªæ–¹æ³•ãŒã‚ã‚Šã¾ã™:
@[card](https://zenn.dev/qqfunc/articles/b39a657990c9f0#:~:text=%E3%83%A1%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89)

> è§£æ±ºç­– 2: `dispatch_async` ã‚’ä½¿ã†

ã‚’å‚è€ƒã«ä»Šå›ã¯å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

## `rootNavigationController.py`

```python
import ctypes

from pyrubicon.objc.api import ObjCClass
from pyrubicon.objc.api import objc_method
from pyrubicon.objc.runtime import send_super, SEL

from .lifeCycle import loop
from .enumerations import UIBarButtonSystemItem

from .functions import NSStringFromClass

UINavigationController = ObjCClass('UINavigationController')
UINavigationBarAppearance = ObjCClass('UINavigationBarAppearance')
UIBarButtonItem = ObjCClass('UIBarButtonItem')


class RootNavigationController(UINavigationController):

  @objc_method
  def dealloc(self):
    # xxx: å‘¼ã¯ã‚™ãªã„-> `send_super(__class__, self, 'dealloc')`
    #print(f'- {NSStringFromClass(__class__)}: dealloc')
    loop.stop()
    #print('--- stop')

  @objc_method
  def loadView(self):
    send_super(__class__, self, 'loadView')
    #print(f'{NSStringFromClass(__class__)}: loadView')
    navigationBarAppearance = UINavigationBarAppearance.new()
    navigationBarAppearance.configureWithDefaultBackground()
    #navigationBarAppearance.configureWithOpaqueBackground()
    #navigationBarAppearance.configureWithTransparentBackground()

    navigationBar = self.navigationBar
    navigationBar.standardAppearance = navigationBarAppearance
    navigationBar.scrollEdgeAppearance = navigationBarAppearance
    navigationBar.compactAppearance = navigationBarAppearance
    navigationBar.compactScrollEdgeAppearance = navigationBarAppearance

  @objc_method
  def viewDidLoad(self):
    send_super(__class__, self, 'viewDidLoad')
    #print(f'{NSStringFromClass(__class__)}: viewDidLoad')
    self.delegate = self

  @objc_method
  def viewWillAppear_(self, animated: bool):
    send_super(__class__,
               self,
               'viewWillAppear:',
               animated,
               argtypes=[
                 ctypes.c_bool,
               ])
    #print(f'{NSStringFromClass(__class__)}: viewWillAppear_')

  @objc_method
  def viewDidAppear_(self, animated: bool):
    send_super(__class__,
               self,
               'viewDidAppear:',
               animated,
               argtypes=[
                 ctypes.c_bool,
               ])
    #print(f'{NSStringFromClass(__class__)}: viewDidAppear_')

  @objc_method
  def viewWillDisappear_(self, animated: bool):
    send_super(__class__,
               self,
               'viewWillDisappear:',
               animated,
               argtypes=[
                 ctypes.c_bool,
               ])
    #print(f'{NSStringFromClass(__class__)}: viewWillDisappear_')

  @objc_method
  def viewDidDisappear_(self, animated: bool):
    send_super(__class__,
               self,
               'viewDidDisappear:',
               animated,
               argtypes=[
                 ctypes.c_bool,
               ])
    #print(f'{NSStringFromClass(__class__)}: viewDidDisappear_')

  @objc_method
  def didReceiveMemoryWarning(self):
    send_super(__class__, self, 'didReceiveMemoryWarning')
    print(f'{NSStringFromClass(__class__)}: didReceiveMemoryWarning')

  @objc_method
  def closeButtonTapped_(self, sender):
    self.dismissViewControllerAnimated_completion_(True, None)

  @objc_method
  def navigationController_willShowViewController_animated_(
      self, navigationController, viewController, animated: bool):
    closeButtonItem = UIBarButtonItem.alloc().initWithBarButtonSystemItem(
      UIBarButtonSystemItem.close,
      target=navigationController,
      action=SEL('closeButtonTapped:'))

    visibleViewController = navigationController.visibleViewController
    navigationItem = visibleViewController.navigationItem
    navigationItem.rightBarButtonItem = closeButtonItem
```

`UINavigationController` ã®ã‚µãƒ–ã‚¯ãƒ©ã‚¹`RootNavigationController` ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚
@[card](https://developer.apple.com/documentation/uikit/uinavigationcontroller?language=objc)

ã‚µãƒ–ã‚¯ãƒ©ã‚¹åŒ–ã™ã‚‹è¿½åŠ ã®æ©Ÿèƒ½ã¨ã—ã¦:

- è‡ªåˆ†è‡ªèº«ã® View ã‚’é–‰ã˜ã‚‹ close ãƒœã‚¿ãƒ³
  - `navigationController_willShowViewController_animated_`
    - `closeButtonTapped_`
- event loop ã‚’æ­¢ã‚ã‚‹
  - `dealloc`
    - `loop.stop`

æ™®é€šã®ã‚¢ãƒ—ãƒªã¨ã¯é•ã„ã€a-Shell ã§å‘¼ã³å‡ºã— a-Shell ã¸æˆ»ã™ã®ã§ã€ãã®æ©Ÿèƒ½ã‚’`RootNavigationController` ã«æŒãŸã›ã¦ã„ã¾ã™ã€‚

### View ã® Life Cycle

[`withModuleToSample.py` ã® Class `MainViewController`](#withModuleToSample.py) ã¨ã‚‚é‡è¤‡ã—ã¾ã™ãŒã€View ã‚’è¡¨ç¤ºã™ã‚‹ Life Cycle ç³»ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’åˆ—æŒ™ã—ã¦ã„ã¾ã™ã€‚ä¸è¦ã§ã‚ã‚Œã°ã‚³ãƒ¼ãƒ‰ã‹ã‚‰å‰Šé™¤ã—ã¦ã‚‚å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

`RootNavigationController` ã®å ´åˆ:

- `viewWillAppear_`
- `viewDidAppear_`
- `viewWillDisappear_`
- `viewDidDisappear_`
- `didReceiveMemoryWarning`

@[card](https://qiita.com/motokiee/items/0ca628b4cc74c8c5599d)

### `loadView`

èª­ã¿è¾¼ã¾ã‚ŒãŸæ™‚ç‚¹ã§ã€`UINavigationBarAppearance` ã«ã‚ˆã‚Š NavigationBar ã®è¦‹ãŸç›®ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚

```python
class RootNavigationController(UINavigationController):
  # ä¸­ç•¥
  @objc_method
  def loadView(self):
    send_super(__class__, self, 'loadView')
    navigationBarAppearance = UINavigationBarAppearance.new()
    navigationBarAppearance.configureWithDefaultBackground()
    #navigationBarAppearance.configureWithOpaqueBackground()
    #navigationBarAppearance.configureWithTransparentBackground()

    navigationBar = self.navigationBar
    navigationBar.standardAppearance = navigationBarAppearance
    navigationBar.scrollEdgeAppearance = navigationBarAppearance
    navigationBar.compactAppearance = navigationBarAppearance
    navigationBar.compactScrollEdgeAppearance = navigationBarAppearance
```

`configureWithDefaultBackground` ã®ä»–ã«:

- `configureWithOpaqueBackground`
- `configureWithTransparentBackground`

ã‚‚ã€ã‚ã‚‹ã®ã§ã€è¡¨ç¤ºã®é•ã„ã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã®ã‚‚ã„ã„ã§ã—ã‚‡ã†ã€‚

@[card](https://llcc.hatenablog.com/entry/2022/01/22/115103)
@[card](https://developer.apple.com/documentation/uikit/uinavigationbarappearance?language=objc)

NavigationBar ã«è¡¨ç¤ºã•ã›ã‚‹ã‚¿ã‚¤ãƒˆãƒ«ã¯ã€[`withModuleToSample.py` ã® Class `MainViewController`](#withModuleToSample.py) ã®ãƒ¡ã‚½ãƒƒãƒ‰å†…ã€‚
ã‚‚ã—ãã¯ã€`MainViewController` ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”Ÿæˆå¾Œã«è¨­å®šã—ã¾ã™ã€‚

### `viewDidLoad`

```python
class RootNavigationController(UINavigationController):
  # ä¸­ç•¥
  @objc_method
  def viewDidLoad(self):
    send_super(__class__, self, 'viewDidLoad')
    self.delegate = self
```

`self.delegate` ã‚’`self` ã¨ã—ã¦ã„ã¾ã™ã€‚
ã“ã‚Œã¯ã€`RootNavigationController` ã‚¯ãƒ©ã‚¹ã§å®šç¾©ã—ãŸ delegate ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç¹‹ããŸã‚ã§ã™ã€‚
ç¹‹ããƒ¡ã‚½ãƒƒãƒ‰ã¯ã€`navigationController_willShowViewController_animated_` ã§ã™ã€‚

`RootNavigationController` ã¯ã€`UINavigationController` ã®ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã§ã™ã€‚
[`UINavigationControllerDelegate`](https://developer.apple.com/documentation/uikit/uinavigationcontrollerdelegate?language=objc) Protocol ã«æº–æ‹ ã—ã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ã€[`navigationController:willShowViewController:animated:`](https://developer.apple.com/documentation/uikit/uinavigationcontrollerdelegate/navigationcontroller%28_:willshow:animated:%29?language=objc) ã‚’ delegate çµŒç”±ã§å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚

### `navigationController_willShowViewController_animated_` ã¨`closeButtonTapped_`

```python
class RootNavigationController(UINavigationController):
  # ä¸­ç•¥
  @objc_method
  def closeButtonTapped_(self, sender):
    self.dismissViewControllerAnimated_completion_(True, None)

  @objc_method
  def navigationController_willShowViewController_animated_(
      self, navigationController, viewController, animated: bool):
    closeButtonItem = UIBarButtonItem.alloc().initWithBarButtonSystemItem(
      UIBarButtonSystemItem.close,  # 24: from .enumerations import UIBarButtonSystemItem
      target=navigationController,
      action=SEL('closeButtonTapped:'))

    visibleViewController = navigationController.visibleViewController
    navigationItem = visibleViewController.navigationItem
    navigationItem.rightBarButtonItem = closeButtonItem
```

`RootNavigationController` ãŒä¹—ã£ãŸ View ãŒè¡¨ç¤ºã•ã‚Œã‚‹ç›´å‰ã€å³è‚©ã« close ãƒœã‚¿ãƒ³ã‚’è¨­ç½®ã—ã¾ã™ã€‚
`_willShowViewController_animated_` ã«ã‚ˆã£ã¦è¡¨ç¤ºã•ã‚Œã‚‹ ViewController ã®`navigationItem` ã¨ã—ã¦æŒ‡å®šã—ã¾ã™ã€‚

@[card](https://developer.apple.com/documentation/uikit/uinavigationcontrollerdelegate/navigationcontroller%28_:willshow:animated:%29?language=objc)
@[card](https://developer.apple.com/documentation/uikit/uinavigationcontroller/visibleviewcontroller?language=objc)

#### close ãƒœã‚¿ãƒ³

close ãƒœã‚¿ãƒ³ï¼ˆ[`UIBarButtonItem`](https://developer.apple.com/documentation/uikit/uibarbuttonitem?language=objc)ï¼‰ç”Ÿæˆæ™‚ã€ã‚¿ãƒƒãƒ—ã•ã‚ŒãŸ action ã‚’ selector(`SEL`) ã§æŒ‡å®šã—ã¾ã™ã€‚
æŒ‡å®šæ–¹æ³•ã¯ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã®`closeButtonTapped_` ã‚’`SEL('closeButtonTapped:')` ã¨ã€æ–‡å­—åˆ—åŒ–ã—`_` ã‚’`:` ã«æ›¸ãæ›ãˆã‚‹ã ã‘ã§ã™ã€‚
`closeButtonTapped_` ã¯ç‹¬è‡ªã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ãªã®ã§ã€`closeButtonTapped_` ä»¥å¤–ã®ä»–ã®åç§°ã§ã‚‚å•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

@[card](https://developer.apple.com/documentation/uikit/uibarbuttonitem?language=objc)
@[card](https://developer.apple.com/documentation/uikit/uibarbuttonitem/init%28barbuttonsystemitem:target:action:%29?language=objc)

close ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‚‰ã€`self.dismissViewControllerAnimated_completion_(True, None)` ãŒç™ºå‹•ã—ã¾ã™ã€‚
ãã—ã¦ã€a-Shell ã‹ã‚‰å‘¼ã³å‡ºã—ãŸå…¨ã¦ã® View ã‚’é–‰ã˜ã¾ã™ã€‚
@[card](https://developer.apple.com/documentation/uikit/uiviewcontroller/dismiss%28animated:completion:%29?language=objc)

### `dealloc` ã§`loop` ã‚’æ­¢ã‚ã‚‹

close ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã“ã¨ã«ã‚ˆã‚Šã€å…¨ã¦ã® View ãŒé–‰ã˜ã‚‰ã‚Œã¾ã™ã€‚
ãã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã€`dealloc` ãŒå‘¼ã°ã‚Œã‚‹ã®ã§ã€èµ°ã£ã¦ã„ã‚‹`loop` ã‚’`stop` ã—ã¾ã™ã€‚
ãã—ã¦ã€`App.main_loop` ã®`loop.run_forever` ãŒçµ‚äº†ã—`loop.close` ã™ã‚‹ã“ã¨ã§ event loop ã‚’çµ‚äº†ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

@[card](https://developer.apple.com/documentation/objectivec/nsobject/1571947-dealloc)

`dealloc` ã§ã¯ã€`send_super` ã¯ä½¿ã„ã¾ã›ã‚“ã€‚Rubicon-ObjC ãŒã‚ˆã—ãªã«å‡¦ç†ã‚’ã—ã¦ãã‚Œã¾ã™ã€‚

## `app.py`

```python
from pyrubicon.objc.api import ObjCClass

from .lifeCycle import loop
from .enumerations import (
  UISceneActivationState,
  UIModalPresentationStyle,
)
from .objcMainThread import onMainThread
from .rootNavigationController import RootNavigationController

UIApplication = ObjCClass('UIApplication')
UIViewController = ObjCClass('UIViewController')  # todo: ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç”¨


class App:

  sharedApplication = UIApplication.sharedApplication
  __objectEnumerator = sharedApplication.connectedScenes.objectEnumerator()
  while (__windowScene := __objectEnumerator.nextObject()):
    if __windowScene.activationState == 0:
      break
  rootViewController = __windowScene.keyWindow.rootViewController

  def __init__(self,
               viewController: UIViewController,
               modalPresentationStyle: UIModalPresentationStyle
               | int = UIModalPresentationStyle.pageSheet):
    self.viewController = viewController
    # xxx: style æŒ‡å®šã‚’åŠ›æŠ€ã¦ã‚™ç¢ºèª
    _automatic = UIModalPresentationStyle.automatic  # -2
    _blurOverFullScreen = UIModalPresentationStyle.blurOverFullScreen  # 8
    _pageSheet = UIModalPresentationStyle.pageSheet  # 1

    self.modalPresentationStyle = modalPresentationStyle if isinstance(
      modalPresentationStyle, int
    ) and _automatic <= modalPresentationStyle <= _blurOverFullScreen else _pageSheet

  def present(self) -> None:

    @onMainThread
    def present_viewController(viewController: UIViewController,
                               style: int) -> None:

      presentViewController = RootNavigationController.alloc(
      ).initWithRootViewController_(viewController)

      presentViewController.setModalPresentationStyle_(style)

      self.rootViewController.presentViewController_animated_completion_(
        presentViewController, True, None)

    present_viewController(self.viewController, self.modalPresentationStyle)
    self.main_loop()

  def main_loop(self) -> None:
    loop.run_forever()
    loop.close()
```

a-Shell ã®`rootViewController` ã¨ã€å®Ÿè£…ã—ãŸ View ã‚’ç¹‹ãã¾ã™ã€‚
`RootNavigationController` ã‚’`self.viewController` ã® NavigationController ã¨ã™ã‚‹ã“ã¨ã§ã€close ãƒœã‚¿ãƒ³ã‚’æŒã£ãŸ View ã¨ã—ã¾ã™ã€‚
Controller ã®æ¥ç¶šã¯ã€Main Thread ä¸Šã§è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿`@onMainThread` ã‚’é–¢æ•°`present_viewController` ã«æŒ‡å®šã—ã€ãã®ä¸­ã§æ¥ç¶šã‚’ã—ã¾ã™ã€‚

### `rootViewController` ã®å–å¾—

ä»¥å‰ã¯ã€`sharedApplication` ã®`windows` ã‹ã‚‰ `keyWindow` çµŒç”±ã§å–å¾—ã‚’ã—ã¦ã„ã¾ã—ãŸã€‚ã—ã‹ã—ã€iOS 15.0 ã‚ˆã‚Šéæ¨å¥¨ã¨ãªã£ãŸã®ã§ã€`connectedScenes` ã‹ã‚‰`windowScene` çµŒç”±ã§å–å¾—ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

æ§˜ã€…ãªå–ã‚Šæ–¹ãŒã‚ã‚‹ã®ã§ã€çŠ¶æ³ã«åˆã‚ã›ã¦é©å®œä½¿ã„åˆ†ã‘ã§ããã†ã§ã™ã€‚
@[card](https://kkfactory92.com/swift-warning002/)
@[card](https://zenn.dev/matsuji/articles/0ee306ddfd10dc)

### `modalPresentationStyle`

a-Shell ã‹ã‚‰è¡¨ç¤ºã•ã›ã‚‹ style ã§ã€å‹ã¯`int` ã§ã™ã€‚å…¨ç”»é¢ã®è¡¨ç¤ºæŒ‡å®šï¼ˆ[`.fullScreen`](https://developer.apple.com/documentation/uikit/uimodalpresentationstyle/fullscreen?language=objc)ï¼‰ã§ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã— a-Shell ã«æˆ»ã‚Œãªã„äº‹æ…‹ã‚’è€ƒæ…®ã—ã¦ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯[`.pageSheet`](https://developer.apple.com/documentation/uikit/uimodalpresentationstyle/pagesheet?language=objc) ã¨ã€ã—ã¦ã„ã¾ã™ã€‚

@[card](https://developer.apple.com/documentation/uikit/uimodalpresentationstyle?language=objc)

å€¤ã®å‚ç…§å…ˆã¯ã€Rust ã® [`objc2`](https://github.com/madsmtm/objc2) ã§ã™:
@[card](https://docs.rs/objc2-ui-kit/latest/src/objc2_ui_kit/generated/UIViewController.rs.html#40)

## `pdbr.py`

Python ã®[`dir`](https://docs.python.org/ja/3.11/library/functions.html#dir) ã®ã‚ˆã†ãªä½¿ã„æ–¹ã‚’ã—ã¾ã™ã€‚
@[card](https://docs.python.org/ja/3.11/library/functions.html#dir)

ä»Šå›ã¯ä½¿ç”¨ã—ã¦ã„ã¾ã›ã‚“ãŒã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæŒã£ã¦ã„ã‚‹è¦ç´ ãªã©ã‚’ç¢ºèªã™ã‚‹ã®ã«ä½¿ã„ã¾ã™ã€‚console ã«åãå‡ºã•ã‚ŒãŸçµæœã‹ã‚‰ã€Apple Developer Documentation ã§æ¤œç´¢ã‚’ã—ãŸã‚Šã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®çŠ¶æ…‹ã‚„è¦ªã® Class ã‚’ç¢ºèªã—ãŸã‚Šã—ã¾ã™ã€‚

@[card](https://zenn.dev/pometa/articles/b8739d6f1ffb68)

### ç¬¬ 2 å¼•æ•°ã®`is_merge_methods`

ç¬¬ 2 å¼•æ•°ã‚’`bool` ã§æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€Class ã”ã¨ã«åˆ†ã‘ã‚‹ã‹ã€ã¾ã¨ã‚ã¦è¡¨ç¤ºã™ã‚‹ã‹é¸ã¶äº‹ãŒã§ãã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã€`False` ã§ã€Class ã”ã¨ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
ç¶™æ‰¿ãŒå¤šãã€ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã§æ¢ã—ãŸã„å ´åˆã«ã¯ã€`True` ã«ã™ã‚‹ã“ã¨ã§ã€ã¾ã¨ã‚ãŸä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```python
pdbr.state(ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ, is_merge_methods:bool)
```

# ãƒ¡ã‚¤ãƒ³ã¨ãªã‚‹ ViewController

`rbedge` ã¨`pyrubicon` ã‚’ä½¿ã£ã¦ã€å®Ÿè£…ã‚’ã—ã¾ã™ã€‚

## `withModuleToSample.py`

```python
import ctypes

from pyrubicon.objc.api import ObjCClass
from pyrubicon.objc.api import objc_method
from pyrubicon.objc.runtime import send_super

from rbedge.functions import NSStringFromClass

UIViewController = ObjCClass('UIViewController')


class MainViewController(UIViewController):

  @objc_method
  def dealloc(self):
    # xxx: å‘¼ã¯ã‚™ãªã„-> `send_super(__class__, self, 'dealloc')`
    print(f'\t - {NSStringFromClass(__class__)}: dealloc')

  @objc_method
  def loadView(self):
    send_super(__class__, self, 'loadView')
    print(f'\t{NSStringFromClass(__class__)}: loadView')

  @objc_method
  def viewDidLoad(self):
    send_super(__class__, self, 'viewDidLoad')
    print(f'\t{NSStringFromClass(__class__)}: viewDidLoad')
    self.navigationItem.title = NSStringFromClass(__class__)

  @objc_method
  def viewWillAppear_(self, animated: bool):
    send_super(__class__,
               self,
               'viewWillAppear:',
               animated,
               argtypes=[
                 ctypes.c_bool,
               ])
    print(f'\t{NSStringFromClass(__class__)}: viewWillAppear_')

  @objc_method
  def viewDidAppear_(self, animated: bool):
    send_super(__class__,
               self,
               'viewDidAppear:',
               animated,
               argtypes=[
                 ctypes.c_bool,
               ])
    print(f'\t{NSStringFromClass(__class__)}: viewDidAppear_')
    print('\tâ†“ ---')

  @objc_method
  def viewWillDisappear_(self, animated: bool):
    print('\tâ†‘ ---')
    send_super(__class__,
               self,
               'viewWillDisappear:',
               animated,
               argtypes=[
                 ctypes.c_bool,
               ])
    print(f'\t{NSStringFromClass(__class__)}: viewWillDisappear_')

  @objc_method
  def viewDidDisappear_(self, animated: bool):
    send_super(__class__,
               self,
               'viewDidDisappear:',
               animated,
               argtypes=[
                 ctypes.c_bool,
               ])
    print(f'\t{NSStringFromClass(__class__)}: viewDidDisappear_')

  @objc_method
  def didReceiveMemoryWarning(self):
    send_super(__class__, self, 'didReceiveMemoryWarning')
    print(f'\t{NSStringFromClass(__class__)}: didReceiveMemoryWarning')


if __name__ == '__main__':
  from rbedge.app import App
  from rbedge.enumerations import UIModalPresentationStyle

  print('--- run ---')
  main_vc = MainViewController.new()

  #presentation_style = UIModalPresentationStyle.fullScreen
  presentation_style = UIModalPresentationStyle.pageSheet

  app = App(main_vc, presentation_style)
  app.present()
  print('--- end ---')
```

module ã«ã¾ã¨ã‚ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ã™ã£ãã‚Šã—ã¾ã—ãŸã€‚[`rootNavigationController`](#rootNavigationController.py) ã®æ™‚ã¨åŒæ§˜ã«ã€View ã‚’è¡¨ç¤ºã™ã‚‹ Life Cycle ç³»ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ä¸è¦ã§ã‚ã‚Œã°ã€å‰Šé™¤ã—ã¦ã—ã¾ã£ã¦å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

å®Ÿè¡Œã™ã‚‹ã¨ã€ç¬¬ 1 éƒ¨ã¨åŒã˜ View ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚æ¬¡ã®ç¬¬ 3 éƒ¨ã§ã¯ã€ã“ã“ã®éƒ¨åˆ†ã«ã‚ãŸã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚

## ãŠã¾ã‘ã®è£œè¶³: Rubicon-ObjC ã§ã® Function å®šç¾©æ–¹æ³•

`NSStringFromClass` ã‚’äº‹ä¾‹ã«ã—ã¾ã™ã€‚

```python
import ctypes

from pyrubicon.objc.api import ObjCInstance
from pyrubicon.objc.runtime import Foundation, Class


def NSStringFromClass(cls: Class) -> ObjCInstance:
  _NSStringFromClass = Foundation.NSStringFromClass
  _NSStringFromClass.restype = ctypes.c_void_p
  _NSStringFromClass.argtypes = [Class]
  return ObjCInstance(_NSStringFromClass(cls))
```

ãªãŠã€ã‚ã–ã‚ã–é–¢æ•°ã§ã€å›²ã‚€å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚é–‹ã„ãŸã‹ãŸã¡ã§ã‚‚å¯èƒ½ã§ã™ãŒ:

```python
# äº‹å‰ã«å®šç¾©ã—ã¦ãŠã„ã¦
NSStringFromClass = Foundation.NSStringFromClass
NSStringFromClass.restype = ctypes.c_void_p
NSStringFromClass.argtypes = [Class]


# ä½¿ç”¨å ´é¢ã§å‘¼ã³å‡ºã™
str_from_class = ObjCInstance(NSStringFromClass(Classåã‚’å–ã‚ŠãŸã„Class))
```

module ã®ç®¡ç†ã¨ã—ã¦ã€è¦‹é€šã—ã‚„åˆ©ä¾¿æ€§ã®è¦³ç‚¹ã§ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã™ã‚‹

Class ã§ã‚ã‚Œã°ã€`ObjCClass({classå})` å®£è¨€ã‚’ã™ã‚‹ã ã‘ã§å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚
![image UIViewController page capture](https://github.com/user-attachments/assets/b21fada6-80f6-4132-94ad-d2f9c1e3e1a4)

@[card](https://developer.apple.com/documentation/uikit/uiviewcontroller?language=objc)

[NSStringFromClass](https://developer.apple.com/documentation/foundation/1395143-nsstringfromclass?language=objc) ã®å ´åˆã¯`Function` ãªã®ã§ã€è‡ªåˆ†ã§å®Ÿè£…ã™ã‚‹éƒ¨åˆ†ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãšæœ€åˆã«æ³¨ç›®ã™ã‚‹ç‚¹ã¯èµ¤æ ã§å›²ã£ã¦ã„ã‚‹ã€`Function` ã¨ã€`Foundation` ã§ã™ã€‚

![image NSStringFromClass page capture](https://github.com/user-attachments/assets/a42ab664-7824-4929-ac67-c0a424468d24)
![image NSStringFromClass page capture](https://github.com/user-attachments/assets/550bd1fe-8eab-4a85-b097-ac2293068156)

### ä½¿ç”¨ã™ã‚‹ Framework ã‚’ç¢ºèª

[Foundation](https://developer.apple.com/documentation/foundation?language=objc) ã¯ Framework ã§ã™ã€‚å¹¸ã„ã«ã‚‚ Rubicon-ObjC ã§ã¯[`rubicon.objc.runtime.Foundation`](https://rubicon-objc.readthedocs.io/en/stable/reference/rubicon-objc-runtime.html#rubicon.objc.runtime.Foundation) ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€`import` ã§ãã¾ã™ã€‚

```python
from pyrubicon.objc.runtime import Foundation
```

ä»–ã« Rubicon-ObjC ã§ã€`libc`, `libobjc` ã¯å®šç¾©ã•ã‚Œã¦ã„ã¾ã™:

- [`libc` | rubicon.objc.runtime â€” Low-level Objective-C runtime access - Rubicon 0.5.0](https://rubicon-objc.readthedocs.io/en/stable/reference/rubicon-objc-runtime.html#rubicon.objc.runtime.libc)
  - [C reference - cppreference.com](https://en.cppreference.com/w/c)
- [`libobjc` | rubicon.objc.runtime â€” Low-level Objective-C runtime access - Rubicon 0.5.0](https://rubicon-objc.readthedocs.io/en/stable/reference/rubicon-objc-runtime.html#rubicon.objc.runtime.libobjc)
  - [Objective-C Runtime | Apple Developer Documentation](https://developer.apple.com/documentation/objectivec?language=objc)

ãã‚Œä»¥å¤–ã® Framework ã¯ã€[`load_library`](https://rubicon-objc.readthedocs.io/en/stable/reference/rubicon-objc-runtime.html#rubicon.objc.runtime.load_library) ã‚’ä½¿ã„ã€è‡ªèº«ã§ load ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### å‹ã‚’ç¢ºèªã—ã€æŒ‡å®š

ç¶šã„ã¦å¼•æ•°ã®å‹ã¨ã€è¿”ã‚Šå€¤ã®å‹ã‚’ç¢ºèªã—`restype` ã¨`argtypes` ã¸å®šç¾©ã—ã¾ã™ã€‚

```objc
NSString * NSStringFromClass(Class aClass);
```

ã“ã“ã‹ã‚‰ã¯ã€ãƒˆãƒ©ã‚¤ã‚¢ãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼ã§æ¤œè¨¼ã‚’ç¹°ã‚Šè¿”ã—ã¦ã„ãã ã‘ã§ã™ã€‚

å¼•æ•°å‹ãŒ`Class` ã ã‹ã€[`ObjCClass`](https://rubicon-objc.readthedocs.io/en/stable/reference/rubicon-objc-api.html#rubicon.objc.api.ObjCClass) ãªã®ã‹ã€‚ã¨ã‚Šã‚ãˆãš[`objc_id`](https://rubicon-objc.readthedocs.io/en/stable/reference/rubicon-objc-runtime.html#rubicon.objc.runtime.objc_id) ã‚’æŒ‡å®šã—ã¦çµæœã‚’è¦‹ã‚‹ã‹ã€‚ãªã©ã€ï¼ˆç§ã¯æœ¬æ ¼çš„ã« Objective-C ã‚„ Swift ã‚’æ›¸ã„ãŸã“ã¨ãŒãªã„ã®ã§ï¼‰è€ƒãˆã‚‰ã‚Œã‚‹å‹ã‚’å…¥ã‚Œã¦æ¤œè¨¼ã—ã¾ã™ã€‚

```python
  _NSStringFromClass.restype = ctypes.c_void_p
  _NSStringFromClass.argtypes = [Class]
  return ObjCInstance(_NSStringFromClass(cls))
```

### å…¬å¼ãŒæ­£ç¾©

Rubicon-ObjC ã§å®Ÿè£…ã™ã‚‹ã«ã‚ãŸã‚Šã€è§£èª¬è¨˜äº‹ãƒ–ãƒ­ã‚°ã‚‚å‚è€ƒã«ãªã‚Šã¾ã™ãŒã€[Apple Developer Documentation](https://developer.apple.com/documentation) ã§èª¿ã¹ãªã„ã¨å¿…è¦æƒ…å ±ã‚’å¾—ã‚‹ã“ã¨ã¯é›£ã—ã„å ´é¢ãŒå¤šã„ã§ã™ã€‚

# ãŠã‚ã‚Šã«

a-Shell ã‚¢ãƒ—ãƒªè‡ªèº«ã¨ã€Python å®Ÿè£…ã§ã® ViewController é€£æºãŒã§ãã¾ã—ãŸã€‚ç¹‹ãè¾¼ã¿ã®éƒ¨åˆ†ã¯å¤šå°‘ hacky ã«ãªã£ã¦ã—ã¾ã„ã¾ã—ãŸãŒã€å„ã‚³ãƒ¼ãƒ‰ã®å½¹å‰²ã‚’æ´ã‚“ã§ã‚‚ã‚‰ãˆã¦ã„ãŸã‚‰å¬‰ã—ã„ã§ã™ã€‚

æ¬¡å›ã¯ã“ã® module ã‚‚æ´»ç”¨ã—ã€ã‚ªãƒªã‚¸ãƒŠãƒ«ãªã‚¢ãƒ—ãƒªã‚’é–‹ç™ºã—ã¾ã™ã€‚Xcode ã¯ã€Storyboard ã¨ã‚³ãƒ¼ãƒ‰ä¸¡æ–¹ã‚’ä½¿ã†é–‹ç™ºã«ãªã‚Šã¾ã™ãŒã€a-Shell ã§ã¯å…¨ã¦ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã§é–‹ç™ºã‚’ã—ã¾ã™ã€‚
