---
title: 'ã€module ç·¨ã€‘#2: a-Shell(mini) ã§ã‚¢ãƒ—ãƒªã‚’ã¤ãã‚‹ã€Rubicon-ObjCã€‘'
emoji: 'ğŸ§³'
type: 'tech'
topics: ['Python', 'iOS', 'objectivec', 'ashell', 'rubiconobjc']
published: false
---


# ã¯ã˜ã‚ã«

iPhone, iPad ã®ç„¡æ–™ã‚¢ãƒ•ã‚šãƒª[a-Shell](https://holzschu.github.io/a-Shell_iOS/) ã‚’ä½¿ã£ã¦ã€[UIKit](https://developer.apple.com/jp/documentation/uikit/) ã‚’å‘¼ã²ã‚™å‡ºã—ã€ã‚¢ãƒ•ã‚šãƒªã‚’ã¤ãã‚Šã¾ã™(Store ã¸ã®å…¬é–‹ã¯ã¦ã‚™ãã¾ã›ã‚“)ã€‚


ä»Šå›è¡¨ç¤ºã•ã‚Œã‚‹View ã®çµæœã¯ã€å‰å›ã¨å¤‰ã‚ã‚Šã‚ã‚Šã¾ã›ã‚“ã€‚1 ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`singleFileSample.py`ï¼‰ã ã£ãŸã‚³ãƒ¼ãƒ‰ã‚’module åŒ–ã—ã€è¦‹é€šã—ã‚’ã‚ˆãã™ã‚‹ã®ãŒç›®çš„ã§ã™ã€‚
ä»Šå¾Œè¨ªã‚Œã‚‹ã‚¢ãƒ—ãƒªé–‹ç™ºã«ãŠã„ã¦ã‚‚ã€å®Ÿè£…ã—ãŸã„ã‚³ãƒ¼ãƒ‰ã«é›†ä¸­ã§ãã‚‹åˆ©ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚

åˆ†å‰²ä½œæ¥­ã¨åŒæ™‚ã«ã‚³ãƒ¼ãƒ‰ã®è£œè¶³ã‚’éšæ‰€ã«å…¥ã‚Œã¦ã„ãã¾ã™ã€‚ä¸æ˜ç­ãªéƒ¨åˆ†ã®è§£æ±ºã«ç¹‹ãŒã‚Œã°å¹¸ã„ã§ã™ã€‚



## å…¨ 3 éƒ¨æ§‹æˆã®ç¬¬ 2 éƒ¨ã¦ã‚™ã™

ã“ã®è¨˜äº‹ã‚’å«ã‚ã€3 éƒ¨æ§‹æˆã¦ã‚™è§£èª¬ã‚’ã—ã¦ã„ãã¾ã™:

- ã€åŸºæœ¬ç·¨ã€‘#1: a-Shell(mini) ã¦ã‚™ã‚¢ãƒ•ã‚šãƒªã‚’ã¤ãã‚‹ã€Rubicon-ObjCã€‘

  - a-Shell å®Ÿè¡Œã®å¤§ã¾ã‹ãªæµã‚Œ
  - 1 ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã®ç°¡æ˜“ãªå®Ÿè£…

- ã€module ç·¨ã€‘#2: a-Shell(mini) ã¦ã‚™ã‚¢ãƒ•ã‚šãƒªã‚’ã¤ãã‚‹ã€Rubicon-ObjCã€‘

  - ï¼ˆä»Šå›ã¯ã“ã“ï¼‰
  - 1 ãƒ•ã‚¡ã‚¤ãƒ«ãŸã‚™ã£ãŸã‚³ãƒ¼ãƒˆã‚™ã‚’ module ã¸åˆ†å‰²
  - å„éƒ¨ã‚³ãƒ¼ãƒˆã‚™ã®èª¬æ˜
  - ã‚¢ãƒ•ã‚šãƒªåˆ¶ä½œã®ãŸã‚ã®ç’°å¢ƒæ•´å‚™

- ã€ã‚¢ãƒ•ã‚šãƒªåˆ¶ä½œç·¨ã€‘#3: a-Shell(mini) ã® Python ã¦ã‚™ UIKit ã‹ã‚‰ View ã‚’å‘¼ã²ã‚™å‡ºã™ã€Rubicon-ObjCã€‘
  - Rubicon-ObjC ã‚’ä½¿ã£ãŸå®Ÿè£…ã®æµã‚Œ
  - Swift, Objective-C ã®ã‚³ãƒ¼ãƒˆã‚™ã‚’ Rubicon-ObjC ã¸è½ã¨ã—è¾¼ã¿

3 ã¤ã®è¨˜äº‹ã‚’é€šã—ãŸã‚³ãƒ¼ãƒˆã‚™ã¯ã€GitHub ã¦ã‚™å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚

@[card](https://github.com/pome-ta/a-Shell_Rubicon-ObjC_UIKitSamples)

:::message

### å„ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±

```
iOS           : 18.3.1
a-Shell(mini) :  1.15.11
  Python      :  3.11.0
Rubicon-ObjC  :  0.5.0
```

(ä¸€å¿œ)a-Shell ä»¥å¤–ã« [Pythonista for iOS](https://omz-software.com/pythonista/index.html) ã¦ã‚™ã€æŒ™å‹•ç¢ºèªã‚’ã—ã¦ã„ã¾ã™ã€‚
:::


## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

[GitHub ã®ãƒªãƒã‚¸ãƒˆãƒª](https://github.com/pome-ta/a-Shell_Rubicon-ObjC_UIKitSamples) ã¯ã€ä»¥ä¸‹ã®æ§‹æˆã§ã™ã€‚


```shell:
[~a-Shell_Rubicon-ObjC_UIKitSamples]$ tree
.
â”œâ”€â”€ README.md
â”œâ”€â”€ (exampleSFSymbolsViewer.py: æ¬¡å›)
â”œâ”€â”€ pyrubicon
â”‚   â””â”€â”€ objc
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ api.py
â”‚       â”œâ”€â”€ collections.py
â”‚       â”œâ”€â”€ ctypes_patch.py
â”‚       â”œâ”€â”€ eventloop.py
â”‚       â”œâ”€â”€ runtime.py
â”‚       â””â”€â”€ types.py
â”œâ”€â”€ rbedge
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ app.py
â”‚   â”œâ”€â”€ enumerations.py
â”‚   â”œâ”€â”€ functions.py
â”‚   â”œâ”€â”€ lifeCycle.py
â”‚   â”œâ”€â”€ objcMainThread.py
â”‚   â”œâ”€â”€ pdbr.py
â”‚   â””â”€â”€ rootNavigationController.py
â”œâ”€â”€ (singleFileSample.py: å‰å›)
â””â”€â”€ withModuleToSample.py
```


`pyrubicon` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ã€[ã€éæ¨å¥¨ã€‘Rubicon-ObjC ã®æ‰‹å‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ»ã‚¤ãƒ³ãƒ›ã‚šãƒ¼ãƒˆ](https://zenn.dev/pometa/articles/466cd4b39f9684)ã€ã®æ–¹æ³•ã§æ ¼ç´ã—ã¦ã„ã¾ã™ã€‚

@[card](https://zenn.dev/pometa/articles/466cd4b39f9684)


`rbedge` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒã€module ã®æ©Ÿèƒ½ã‚’æŒã¡ã¾ã™ã€‚`singleFileSample.py` ã‚’åˆ†å‰²ã—ãŸã‚³ãƒ¼ãƒ‰ã§ã™ã€‚




# `rbedge` module


ã€Œ**r**u**b**icon å·ã®æ©‹ï¼ˆbridgeï¼‰ã®ç«¯ï¼ˆedgeï¼‰ã€

ã¨ã—ã¦ã€`rbedge` ã¨å‘½åã—ã¦ã¿ã¾ã—ãŸã€‚åˆ¥ã®module åã§ã‚‚å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚


## `__init__.py`

```python
__version__ = '0.0.0'

import sys
import os
import ctypes

from pyrubicon.objc.api import ObjCClass, ObjCInstance
from pyrubicon.objc.runtime import Foundation

ObjCClass.auto_rename = True

#######################################################
# --- exception
#######################################################
# todo: from objc_util.py of Pythonista3
ExceptionHandlerFuncType = ctypes.CFUNCTYPE(None, ctypes.c_void_p)


def NSSetUncaughtExceptionHandler(_exc: ExceptionHandlerFuncType) -> None:
  _NSSetUncaughtExceptionHandler = Foundation.NSSetUncaughtExceptionHandler
  _NSSetUncaughtExceptionHandler.restype = None
  _NSSetUncaughtExceptionHandler.argtypes = [
    ExceptionHandlerFuncType,
  ]
  _NSSetUncaughtExceptionHandler(_exc)


def _objc_exception_handler(_exc):
  exc = ObjCInstance(_exc)
  with open(os.path.expanduser('~/Documents/_rubicon_objc_exception.txt'),
            'w') as f:
    import datetime
    f.write(
      'The app was terminated due to an Objective-C exception. Details below:\n\n%s\n%s\n'
      % (datetime.datetime.now(), exc))


_handler = ExceptionHandlerFuncType(_objc_exception_handler)
NSSetUncaughtExceptionHandler(_handler)
#######################################################
```

`__init__.py` ã¯ã€ç©ºãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚ã‚‹äº‹ãŒå¤šã„ã§ã™ãŒã€2ç‚¹è¨­å®šã—ã¦ã„ã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰å…¨ä½“ã«å½±éŸ¿ã•ã›ã¾ã™ã€‚


### `ObjCClass.auto_rename` ã®`True`

é€£ç¶šã¦ã‚™å®Ÿè¡Œã™ã‚‹éš›ã®class name è¡çªã‚¨ãƒ©ãƒ¼ã‚’å›é¿ã—ã¾ã™ã€‚

@[card](https://rubicon-objc.readthedocs.io/en/stable/tutorial/tutorial-2.html#class-naming)
@[card](https://zenn.dev/qqfunc/articles/b39a657990c9f0#:~:text=Objective%2DC%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E5%AE%9A%E7%BE%A9)


### é–¢æ•°: `NSSetUncaughtExceptionHandler`

```py
_handler = ExceptionHandlerFuncType(_objc_exception_handler)
NSSetUncaughtExceptionHandler(_handler)
```

Objective-C ã§ã®ã‚¨ãƒ©ãƒ¼æƒ…å ±ã‚’a-Shell ã®`./Documents` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸`_rubicon_objc_exception.txt` ã¨ã—ã¦åãå‡ºã—ã¾ã™ã€‚

```py
with open(os.path.expanduser('~/Documents/_rubicon_objc_exception.txt'), 'w') as f:
```

Main Thread å¤–ã§ã®UI æ›´æ–°ã‚„ã€é…åˆ—ã®index å¤–ã®å‘¼ã³å‡ºã—ãªã©ã‚’æ•™ãˆã¦ãã‚Œã¾ã™ã€‚æ•æ‰ã—ã¦ãã‚Œã‚‹ã‚¨ãƒ©ãƒ¼ã¯å°‘ãªã„ã§ã™ãŒã€ãƒ‡ãƒãƒƒã‚°ã™ã‚‹æ‰‹ç«‹ã¦ãŒå°‘ãªã„Rubicon-ObjC ã§ã¯å°ã•ãªæƒ…å ±ã§ã‚‚ã‚ã‚ŠãŒãŸã„ã®ã§ã™ã€‚

:::message
Pythonista3 ã®`objc_util.py` ã®ã‚³ãƒ¼ãƒ‰ã‚’å‚è€ƒã«ã—ã¦ã„ã¾ã™ã€‚
:::

Apple Developer Documents ã®ãƒªãƒ³ã‚¯ã¯ä»¥ä¸‹ã¨ãªã‚Šã¾ã™ã€‚
@[card](https://developer.apple.com/documentation/foundation/1409609-nssetuncaughtexceptionhandler?language=objc)


é–¢æ•°ã®å®šç¾©æ–¹æ³•ã¯ã€ä»¥ä¸‹å‚ç…§


## `enumerations.py`


```python
from dataclasses import dataclass


class UIModalPresentationStyle:
  automatic: int = -2
  none: int = -1
  fullScreen: int = 0
  pageSheet: int = 1
  formSheet: int = 2
  currentContext: int = 3
  custom: int = 4
  overFullScreen: int = 5
  overCurrentContext: int = 6
  popover: int = 7
  blurOverFullScreen: int = 8

@dataclass
class UIRectEdge:
  none: int = 0
  top: int = 1 << 0
  left: int = 1 << 1
  bottom: int = 1 << 2
  right: int = 1 << 3
  all: int = top | left | bottom | right
```

ï¼ˆä¸€éƒ¨ã‚’æŠœãå‡ºã—ï¼‰

Enumeration Case ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã¾ã¨ã¾ã‚Šã§ã™ã€‚class ã§è¦ç´ ã‚’ã¾ã¨ã‚ãŸã„ã®ã§ã€Swift ã®è¡¨è¨˜ã§çµ±ä¸€ã—ã¦ã„ã¾ã™ã€‚
æ¼”ç®—ãŒå¿…è¦ã«ãªã‚‹ï¼ˆãªã‚Šãã†ï¼‰ãªè¦ç´ ã¯ã€`@dataclass` ã—ã¦ã„ã¾ã™ã€‚
å®šç¾©ã™ã‚‹å€¤ã«é–¢ã—ã¦ã€Apple Developer Documentation ã¦ã‚™Enumeration Case ã¯ï¼ˆSwift ã‚‚Objective-C ã®ãƒ˜ã‚šãƒ¼ã‚·ã‚™ã‚‚ï¼‰ä¸æ˜ãªã“ã¨ã‹ã‚™å¤šã„ã¦ã‚™ã™ã€‚

@[card](https://developer.apple.com/documentation/uikit/uimodalpresentationstyle)


ãã®å ´åˆã¯ã€Rust ã®Apple frameworks ãƒã‚™ã‚¤ãƒ³ãƒ†ã‚™ã‚£ãƒ³ã‚¯ã‚™ `objc2` ã‹ã‚‰source ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚
@[card](https://docs.rs/objc2-ui-kit/latest/src/objc2_ui_kit/generated/UIViewController.rs.html#40)

æƒ…å ±ãŒå¤ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€Xamarin ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã‚‚ç¨€ã«è¦‹ã¤ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚



## `functions.py`

```python
import ctypes

from pyrubicon.objc.api import ObjCInstance
from pyrubicon.objc.runtime import Foundation, Class


def NSStringFromClass(cls: Class) -> ObjCInstance:
  _NSStringFromClass = Foundation.NSStringFromClass
  _NSStringFromClass.restype = ctypes.c_void_p
  _NSStringFromClass.argtypes = [Class]
  return ObjCInstance(_NSStringFromClass(cls))
```

ç¾åœ¨ã¯`NSStringFromClass` 1ã¤ã®ã¿ã§ã™ã€‚


## `lifeCycle.py`

## `objcMainThread.py`

## `rootNavigationController.py`

## `app.py`

## `pdbr.py`



# main ã¨ãªã‚‹`viewController`

## `withModuleToSample.py`





### Objective-C ã®`Function` å®Ÿè£…

Rubicon-ObjC ã¦ã‚™å®Ÿè£…ã™ã‚‹ã«ã‚ãŸã‚Šã€[Apple Developer Documentation](https://developer.apple.com/documentation) ã¯å¿…é ˆã¨è¨€ã£ã¦ã‚‚éè¨€ã¦ã‚™ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

Class ã¦ã‚™ã‚ã‚Œã¯ã‚™ã€`ObjCClass({classå})` å®£è¨€ã‚’ã™ã‚‹ãŸã‚™ã‘ã¦ã‚™å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚
![todo: iPhone ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã«å·®ã—æ›¿ãˆäºˆå®š Image](https://github.com/user-attachments/assets/0cb41222-2c7a-4638-82f5-27326a00387f)

[NSSetUncaughtExceptionHandler](https://developer.apple.com/documentation/foundation/1409609-nssetuncaughtexceptionhandler?language=objc) ã®å ´åˆã¯ã€`Function` ã¦ã‚™ã™ã€‚ç¢ºèªã™ã‚‹ç‚¹ã‚‚å«ã‚ã¦æ•´ç†ã—ã¦ã„ãã¾ã™ã€‚
![todo: iPhone ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã«å·®ã—æ›¿ãˆäºˆå®š Image](https://github.com/user-attachments/assets/6fbb14f6-0794-4345-b0f6-62de8822a6f7)

Objective-C ã‹ã‚‰Rubicon-ObjC ã‚’å®£è¨€ã™ã‚‹ä¸­ã¦ã‚™

`ObjCClass`


todo: iPhone ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã«å·®ã—æ›¿ãˆäºˆå®š

![todo: iPhone ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã«å·®ã—æ›¿ãˆäºˆå®š Image](https://github.com/user-attachments/assets/6fbb14f6-0794-4345-b0f6-62de8822a6f7)

![todo: iPhone ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã«å·®ã—æ›¿ãˆäºˆå®š Image](https://github.com/user-attachments/assets/0cb41222-2c7a-4638-82f5-27326a00387f)

![todo: iPhone ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã«å·®ã—æ›¿ãˆäºˆå®š Image](https://github.com/user-attachments/assets/038ebbb6-2f86-45f9-96f7-35d5a884f51b)




# ãŠã‚ã‚Šã«

a-Shell ã‚¢ãƒ•ã‚šãƒªè‡ªèº«ã¨ã€Python å®Ÿè£…ã§ã® ViewController é€£æºã‹ã‚™ã¦ã‚™ãã¾ã—ãŸã€‚ç¹‹ãã‚™è¾¼ã¿ã®éƒ¨åˆ†ã¯å¤šå°‘ hacky ã«ãªã£ã¦ã—ã¾ã„ã¾ã—ãŸã‹ã‚™ã€å„ã‚³ãƒ¼ãƒ‰ã®å½¹å‰²ã‚’æ´ã‚“ã¦ã‚™ã‚‚ã‚‰ãˆã¦ã„ãŸã‚‰å¬‰ã—ã„ã¦ã‚™ã™ã€‚


æ¬¡å›ã¯ã“ã®module ã‚‚æ´»ç”¨ã—ã€ã‚ªãƒªã‚¸ãƒŠãƒ«ãªã‚¢ãƒ—ãƒªã‚’é–‹ç™ºã—ã¾ã™ã€‚Xcode ã¯ã€Storyboard ã¨ã‚³ãƒ¼ãƒ‰ä¸¡æ–¹ã‚’ä½¿ã†é–‹ç™ºã«ãªã‚Šã¾ã™ãŒã€a-Shell ã§ã¯å…¨ã¦ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã§é–‹ç™ºã‚’ã—ã¾ã™ã€‚

